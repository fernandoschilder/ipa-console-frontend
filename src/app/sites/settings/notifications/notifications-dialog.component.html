<h2 mat-dialog-title>Notificaciones</h2>

<mat-dialog-content>
  <!-- Preferencias simples (mock) -->
  <section style="display:grid; grid-template-columns: 1fr 2fr; gap:16px; margin-bottom:16px;">
    <div>
      <h3 style="margin:0 0 8px;">Preferencias</h3>

      <mat-slide-toggle [formControl]="form.controls.emailChannel">
        Recibir por correo electrónico
      </mat-slide-toggle>

      <div style="margin-top:12px;">
        <mat-form-field appearance="outline" style="width:100%;">
          <mat-label>Severidad mínima</mat-label>
          <mat-select [formControl]="form.controls.minSeverity">
            <mat-option value="INFO">INFO</mat-option>
            <mat-option value="WARNING">WARNING</mat-option>
            <mat-option value="SECURITY">SECURITY</mat-option>
            <mat-option value="SYSTEM">SYSTEM</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div>
        <mat-form-field appearance="outline" style="width:100%;">
          <mat-label>Namespaces</mat-label>
          <mat-select [formControl]="form.controls.namespaces" multiple>
            <mat-option value="inteligencia_comercial">inteligencia_comercial</mat-option>
            <mat-option value="marketing">marketing</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div style="display:flex; gap:8px;">
        <button mat-stroked-button color="primary" (click)="savePrefs()">Guardar preferencias</button>
        <button mat-button (click)="testNotification()">Probar notificación</button>
      </div>
    </div>

    <div>
      <h3 style="margin:0 0 8px;">Recientes</h3>
      <mat-divider></mat-divider>

      <div style="display:flex; gap:8px; align-items:center; margin:12px 0;">
        <button mat-stroked-button color="primary" (click)="markAllRead()">Marcar todas como leídas</button>
      </div>

      <mat-list>
        <ng-container *ngIf="(items$ | async) as items">
          <mat-list-item *ngFor="let n of items">
            <mat-icon matListItemIcon [color]="colorFor(n)">{{ iconFor(n) }}</mat-icon>
            <div matListItemTitle style="display:flex; gap:8px; align-items:center;">
              <span [style.font-weight]="n.read ? 400 : 600">{{ n.title }}</span>
              <mat-chip *ngIf="!n.read" color="primary" selected>Nuevo</mat-chip>
            </div>
            <div matListItemLine style="opacity:.85">{{ n.message }}</div>
            <div matListItemLine style="font-size:12px; opacity:.6;">{{ n.date }}</div>
            <button mat-button (click)="markRead(n.id)" [disabled]="n.read">Marcar leído</button>
          </mat-list-item>

          <div *ngIf="items.length === 0" style="opacity:.7; padding:12px;">
            No tienes notificaciones por ahora.
          </div>
        </ng-container>
      </mat-list>
    </div>
  </section>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Cerrar</button>
</mat-dialog-actions>
